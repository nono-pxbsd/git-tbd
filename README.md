# gittbd

Un outil CLI simple et puissant pour g√©rer un workflow Git en mode **Trunk-Based Development (TBD)**.

---

## üì¶ Pr√©requis

### Obligatoires

- **Git** : Gestion de versions
  ```bash
  sudo apt install git  # Ubuntu/Debian/WSL
  ```

- **Bash ou Zsh** : Shell Unix (g√©n√©ralement d√©j√† install√©)

- **GitHub CLI** (`gh`) **OU** **GitLab CLI** (`glab`) : Gestion des PR/MR
  ```bash
  # Pour GitHub
  sudo apt install gh
  gh auth login
  
  # Pour GitLab
  # Voir https://gitlab.com/gitlab-org/cli
  glab auth login
  ```

### Fortement recommand√©s

#### üîç fzf - Fuzzy Finder

**fzf** am√©liore consid√©rablement l'exp√©rience utilisateur avec des menus interactifs modernes.

**Installation** :

```bash
# Ubuntu / Debian / WSL
sudo apt update && sudo apt install -y fzf

# macOS
brew install fzf

# Arch Linux
sudo pacman -S fzf

# Fedora
sudo dnf install fzf
```

**Sans fzf** : Un menu classique num√©rot√© sera utilis√© (fonctionnel mais moins pratique).

---

## ‚ú® Fonctionnalit√©s

- üöÄ Cr√©e automatiquement des branches `feature/xxx`, `fix/xxx`, etc.
- üéØ S√©lection interactive du type de branche avec `fzf` (ou menu classique)
- üîÑ Rebase la branche actuelle sur `main`
- üîÄ Merge proprement dans `main` avec **local-squash** (√©vite la d√©synchronisation)
- üì¶ Ouvre automatiquement une Pull Request / Merge Request
- üè∑Ô∏è Gestion des versions avec tags SemVer (`bump`)
- üß≠ Aide interactive int√©gr√©e
- ü¶ä Support **GitHub** et **GitLab**

---

## ‚öôÔ∏è Installation

### üìç M√©thode recommand√©e (clone + symlinks)

Cette m√©thode permet de **mettre √† jour facilement** via `git pull` sans r√©installer.

```bash
# 1. Cloner le repo dans ~/.local/share/gittbd/ (AVEC .git/)
git clone https://github.com/nono-pxbsd/git-tbd.git ~/.local/share/gittbd

# 2. Installer (cr√©e des symlinks vers le repo)
cd ~/.local/share/gittbd
make install MODE=local

# 3. Recharger le shell
source ~/.zshrc  # ou ~/.bashrc
```

**Ce qui est install√©** :
- ‚úÖ V√©rifie automatiquement les d√©pendances (git, gh/glab, fzf)
- ‚úÖ Cr√©e des **symlinks** dans `~/.local/bin/` vers le repo clon√©
- ‚úÖ Cr√©e un alias `git-tbd` pour r√©trocompatibilit√©
- ‚úÖ Ajoute `~/.local/bin` au `$PATH` si n√©cessaire

**Avantages de cette m√©thode** :
- üîÑ **Mises √† jour faciles** : `cd ~/.local/share/gittbd && git pull`
- üîó Les symlinks pointent toujours vers la derni√®re version
- üì¶ Pas besoin de r√©installer apr√®s chaque mise √† jour
- üéØ Le repo contient `.git/` pour les futures mises √† jour

---

### üîÑ Mettre √† jour gittbd

Une fois install√© via la m√©thode recommand√©e :

```bash
# Se placer dans le r√©pertoire d'installation
cd ~/.local/share/gittbd

# R√©cup√©rer les derni√®res modifications
git pull

# C'est tout ! Les symlinks pointent vers les nouveaux fichiers
# Pas besoin de make install √† nouveau
```

**V√©rifier la version install√©e** :
```bash
gittbd help
# Affiche la version et les commandes disponibles
```

---

### üõ†Ô∏è Installation globale (optionnel)

Pour une installation syst√®me (accessible par tous les utilisateurs) :

```bash
cd ~/.local/share/gittbd
sudo make install MODE=global
```

Les binaires seront install√©s dans `/usr/local/bin/`.

---

### üóëÔ∏è D√©sinstallation

```bash
cd ~/.local/share/gittbd
make uninstall

# Pour supprimer compl√®tement le repo
rm -rf ~/.local/share/gittbd
```

---

## üìá Mode Silencieux

### üîá Commande `gittbds` (recommand√©)

Depuis l'installation, vous disposez automatiquement de la commande **`gittbds`** (avec "s" pour silent) :

```bash
# Mode normal (verbeux)
gittbd finish

# Mode silencieux (minimal)
gittbds finish
```

**Avantages** :
- ‚úÖ Pas de configuration n√©cessaire
- ‚úÖ Fonctionne partout (shell, scripts, CI/CD)
- ‚úÖ Plus simple que `SILENT_MODE=true gittbd ...`

### Configuration avanc√©e (optionnel)

Si vous pr√©f√©rez que `gittbd` soit silencieux **par d√©faut** :

```bash
# Ex√©cuter le script de configuration
bash ~/.local/share/gittbd/bin/setup-silent-mode.sh
```

Le script vous proposera plusieurs options :

1. **Mode silencieux par d√©faut** : `gittbd` sera toujours silencieux
2. **Alias `gittbds`** : Garde `gittbd` verbeux, cr√©e un alias shell `gittbds`
3. **Les deux** : Maximum de flexibilit√©

### Configuration manuelle

```bash
# Mode silencieux par d√©faut
echo 'export SILENT_MODE=true' >> ~/.zshrc  # ou ~/.bashrc
source ~/.zshrc

# OU cr√©er un alias shell (si vous pr√©f√©rez)
echo "alias gittbds='SILENT_MODE=true gittbd'" >> ~/.zshrc
source ~/.zshrc

# OU utiliser la variable ponctuellement
SILENT_MODE=true gittbd finish
```

---

## üß™ Commandes disponibles

### üü¢ `gittbd start` (alias: `s`)

Cr√©e une nouvelle branche √† partir de `main`.

```bash
# Mode complet (type/nom)
gittbd start feature/login-form

# Mode semi-interactif (seulement le nom)
gittbd start login-form
# ‚Üí fzf s'ouvre pour choisir le type

# Mode full interactif
gittbd start
# ‚Üí fzf pour le type
# ‚Üí Demande du nom

# Raccourci
gittbd s
```

**Types disponibles** : `feature`, `fix`, `hotfix`, `chore`, `doc`, `test`, `refactor`, `release`

---

### üîÄ `gittbd finish` (alias: `f`)

Merge la branche actuelle dans `main`, push et supprime la branche.

```bash
# Finish simple (local)
gittbd finish

# Finish avec cr√©ation de PR/MR
gittbd finish --pr

# Mode silencieux
SILENT_MODE=true gittbd finish

# Raccourci
gittbd f --pr
```

**Options** :
- `--pr` / `-p` : Ouvre une PR/MR automatiquement
- `--silent` / `-s` : Mode silencieux
- `--method=<mode>` : Force une m√©thode (squash/merge/local-squash)

---

### üöÄ `gittbd publish` (alias: `p`)

Push la branche courante sur `origin`.

```bash
# Publication normale
gittbd publish

# Avec force (mode intelligent)
gittbd publish --force

# Force uniquement le push (apr√®s squash local)
gittbd publish --force-push

# Force uniquement la sync (branche en retard)
gittbd publish --force-sync

# Raccourci
gittbd p
```

**Options** :
- `--force` / `-f` : D√©tection intelligente (selon l'√©tat de la branche)
- `--force-push` : Force push avec `--force-with-lease` (s√©curis√©)
- `--force-sync` : Force sync (rebase) puis push

---

## üéØ Cas d'usage : Configuration de `publish` pour branche diverg√©e

Quand une branche a **diverg√©** d'origin (apr√®s `git commit --amend`, rebase local, ou push concurrent), `gittbd publish --force` doit choisir une strat√©gie. Voici comment configurer selon votre situation.

---

### üìä Tableau r√©capitulatif

| Situation | Configuration recommand√©e | Comportement |
|-----------|---------------------------|--------------|
| **Travail solo** | `DEFAULT_DIVERGED_STRATEGY="force-push"` | Force push automatique (pas de prompt) |
| **Workflow TBD standard** | `DEFAULT_DIVERGED_STRATEGY="ask"` | Prompt interactif en local |
| **Collaboration sur branches** | `DEFAULT_DIVERGED_STRATEGY="ask"`<br>`SILENT_DIVERGED_FALLBACK="force-sync"` | Prompt en local, sync en CI/CD |
| **Tr√®s prudent** | `DEFAULT_DIVERGED_STRATEGY="force-sync"` | Toujours sync (jamais force push auto) |

---

### üîß Configuration dans `lib/config.sh`

```bash
# Strat√©gie par d√©faut : "ask" | "force-push" | "force-sync"
DEFAULT_DIVERGED_STRATEGY="ask"

# Fallback en mode silencieux (si strategy = "ask")
SILENT_DIVERGED_FALLBACK="force-push"
```

---

### üé≠ Cas d'usage d√©taill√©s

#### Cas 1 : D√©veloppeur solo / Branches personnelles

**Situation** : Vous travaillez seul sur vos branches feature. Personne d'autre ne push dessus.

**Pourquoi la branche diverge** : Apr√®s `git commit --amend`, rebase local, ou squash.

**Configuration recommand√©e** :
```bash
# lib/config.sh
DEFAULT_DIVERGED_STRATEGY="force-push"
```

**Comportement** :
```bash
# Apr√®s un amend
git commit --amend --no-edit

# Publish
gittbd publish --force
# ‚úÖ Force push direct (pas de prompt)
# ‚Üí Votre local est toujours la v√©rit√©
```

**Avantages** :
- ‚úÖ Workflow rapide (pas de prompt inutile)
- ‚úÖ Pas de risque (vous √™tes seul sur la branche)

---

#### Cas 2 : Workflow Trunk-Based Development classique

**Situation** : √âquipe utilisant TBD avec branches courtes dur√©es (1-3 jours max). Chacun travaille sur SA branche.

**Pourquoi la branche diverge** : 
- 99% : `git commit --amend` ou squash local
- 1% : Erreur de manip (push depuis 2 machines)

**Configuration recommand√©e** :
```bash
# lib/config.sh
DEFAULT_DIVERGED_STRATEGY="ask"  # Prompt par d√©faut (s√©curit√©)
SILENT_DIVERGED_FALLBACK="force-push"  # En CI/CD, assume amend
```

**Comportement** :
```bash
# En local (d√©veloppement)
gittbd publish --force

# ‚ö†Ô∏è Branche diverg√©e d√©tect√©e
# 
# Quelle strat√©gie utiliser ?
# 
#   1. Force push (local √©crase origin)
#      ‚Üí Recommand√© apr√®s amend/rebase/squash local
# 
#   2. Sync puis push (rebase origin dans local)
#      ‚Üí Recommand√© si quelqu'un a push√© pendant que vous travailliez
# 
# Choix [1/2] : 1
# ‚úÖ Force push s√©lectionn√©

# En CI/CD (automatisation)
SILENT_MODE=true gittbd publish --force
# ‚úÖ Force push automatique (pas de prompt)
```

**Avantages** :
- ‚úÖ S√©curit√© : Prompt √©vite les erreurs
- ‚úÖ P√©dagogique : Messages expliquent les choix
- ‚úÖ CI/CD compatible : Fallback automatique

---

#### Cas 3 : Collaboration sur les m√™mes branches

**Situation** : Plusieurs d√©veloppeurs peuvent push sur la m√™me branche feature (pair programming, handoff).

**Pourquoi la branche diverge** :
- 50% : Push concurrent (coll√®gue a push√© pendant que vous travailliez)
- 50% : Amend/rebase local

**Configuration recommand√©e** :
```bash
# lib/config.sh
DEFAULT_DIVERGED_STRATEGY="ask"
SILENT_DIVERGED_FALLBACK="force-sync"  # En CI/CD, pr√©f√®re int√©grer
```

**Comportement** :
```bash
# En local
gittbd publish --force

# ‚ö†Ô∏è Branche diverg√©e d√©tect√©e
# 
# Quelle strat√©gie utiliser ?
# 
#   1. Force push (local √©crase origin)
#      ‚Üí Recommand√© apr√®s amend/rebase/squash local
# 
#   2. Sync puis push (rebase origin dans local)
#      ‚Üí Recommand√© si quelqu'un a push√© pendant que vous travailliez
# 
# Choix [1/2] : 2
# ‚úÖ Sync puis push s√©lectionn√©
# ‚Üí Int√®gre les changements du coll√®gue

# En CI/CD
SILENT_MODE=true gittbd publish --force
# ‚úÖ Sync automatique (int√®gre les changements distants)
```

**Avantages** :
- ‚úÖ √âvite d'√©craser le travail des autres
- ‚úÖ Prompt permet de choisir selon le contexte
- ‚úÖ CI/CD int√®gre automatiquement

---

#### Cas 4 : √âquipe tr√®s prudente (no force push)

**Situation** : Politique stricte "jamais de force push", toujours int√©grer les changements distants.

**Configuration recommand√©e** :
```bash
# lib/config.sh
DEFAULT_DIVERGED_STRATEGY="force-sync"
```

**Comportement** :
```bash
gittbd publish --force
# ‚úÖ Sync automatique (rebase)
# ‚Üí Jamais de force push, toujours int√©gration
```

**Avantages** :
- ‚úÖ Politique stricte appliqu√©e automatiquement
- ‚úÖ Pas de risque d'√©crasement

**Inconv√©nient** :
- ‚ö†Ô∏è Si vous VOULEZ force push (apr√®s amend volontaire), utilisez explicitement :
  ```bash
  gittbd publish --force-push
  ```

---

### üö¶ R√©sum√© des strat√©gies

#### `"ask"` (par d√©faut) - S√©curit√© maximale

**Quand** : Vous n'√™tes pas s√ªr de la cause de la divergence.

**Comportement** :
- Mode normal : Prompt interactif
- Mode silencieux : Utilise `SILENT_DIVERGED_FALLBACK`

**Cas d'usage** : Workflow collaboratif, √©quipes mixtes

---

#### `"force-push"` - Workflow solo rapide

**Quand** : Vous travaillez seul, divergence = toujours amend/rebase local.

**Comportement** :
- Force push direct (pas de prompt)
- Assume que le local est toujours la v√©rit√©

**Cas d'usage** : Dev solo, branches perso, prototypes

---

#### `"force-sync"` - Politique prudente

**Quand** : Politique "toujours int√©grer, jamais √©craser".

**Comportement** :
- Sync (rebase) automatique
- Jamais de force push sans flag explicite

**Cas d'usage** : √âquipes prudentes, collaboration intense

---

### üí° Bypass du prompt (flags explicites)

**M√™me avec `strategy="ask"`, vous pouvez forcer explicitement** :

```bash
# Force push direct (pas de prompt)
gittbd publish --force-push

# Sync direct (pas de prompt)
gittbd publish --force-sync

# Le flag --force utilise la strat√©gie configur√©e
gittbd publish --force  # ‚Üí Peut prompter si strategy="ask"
```

---

### üìã Aide-m√©moire

| Commande | Avec `strategy="ask"` | Avec `strategy="force-push"` | Avec `strategy="force-sync"` |
|----------|----------------------|------------------------------|------------------------------|
| `publish` | ‚ùå Erreur + suggestions | ‚ùå Erreur + suggestions | ‚ùå Erreur + suggestions |
| `publish --force` | üí¨ Prompt (choix 1 ou 2) | ‚úÖ Force push | ‚úÖ Sync puis push |
| `publish --force-push` | ‚úÖ Force push | ‚úÖ Force push | ‚úÖ Force push |
| `publish --force-sync` | ‚úÖ Sync puis push | ‚úÖ Sync puis push | ‚úÖ Sync puis push |

---

### üîç Diagnostic : Pourquoi ma branche a diverg√© ?

```bash
# Voir les commits locaux uniquement
git log origin/ma-branch..HEAD --oneline

# Voir les commits distants uniquement
git log HEAD..origin/ma-branch --oneline

# Comparer visuellement
git log --graph --oneline --all
```

**Interpr√©tation** :
- Si commits locaux = versions amend√©es des commits distants ‚Üí `force-push`
- Si commits distants = nouveaux commits d'un coll√®gue ‚Üí `force-sync`

---

### üéì Bonne pratique

**Pour √©viter les divergences** :
1. Toujours `git pull` avant de travailler
2. √âvitez `git commit --amend` apr√®s avoir push√© (utilisez plut√¥t un nouveau commit)
3. Si vous devez amend/rebase apr√®s push : `gittbd publish --force-push`

**En cas de doute** : Gardez `strategy="ask"` et lisez les messages du prompt. üéØ

---

### üì¶ `gittbd pr` / `gittbd mr`

Ouvre automatiquement une Pull Request (GitHub) ou Merge Request (GitLab).

```bash
# Sur GitHub
gittbd pr

# Sur GitLab (plus naturel)
gittbd mr

# Les deux fonctionnent partout
```

---

### ‚úÖ `gittbd validate` (alias: `v`, `merge`)

Valide une Pull Request / Merge Request.

```bash
# Validation interactive
gittbd validate

# Validation avec la branche sp√©cifi√©e
gittbd validate feature/login-form

# Mode automatique (CI/CD)
gittbd validate --assume-yes

# Raccourcis
gittbd v
gittbd merge
```

---

### üîÑ `gittbd sync`

Met √† jour la branche courante depuis `main`.

```bash
gittbd sync

# Avec force (en cas de retard)
gittbd sync --force
```

---

### üè∑Ô∏è `gittbd bump` (alias: `b`)

Cr√©e un tag de version selon Semantic Versioning.

```bash
# Correction de bug (1.0.0 ‚Üí 1.0.1)
gittbd bump patch

# Nouvelle fonctionnalit√© (1.0.0 ‚Üí 1.1.0)
gittbd bump minor

# Breaking change (1.0.0 ‚Üí 2.0.0)
gittbd bump major

# Mode automatique (CI/CD)
gittbd bump patch --yes

# Raccourci
gittbd b patch
```

---

## üìá Mode Silencieux d√©taill√©

R√©duit la verbosit√© en n'affichant que les erreurs et succ√®s finaux.

### Activation

```bash
# Temporaire (une commande)
SILENT_MODE=true gittbd finish

# Permanent (session)
export SILENT_MODE=true

# Permanent (shell) - voir section installation ci-dessus
bash ~/.local/share/gittbd/bin/setup-silent-mode.sh
```

### Fonctions impact√©es

| Commande | Comportement normal | Mode silencieux |
|----------|---------------------|-----------------|
| `start` | Affiche les √©tapes (checkout, pull, cr√©ation) | Erreurs + succ√®s final uniquement |
| `finish` | Demande confirmation, affiche le squash | Pas de confirmation (avec --silent), minimal |
| `publish` | Affiche synchro, v√©rifications | Erreurs uniquement |
| `validate` | Affiche PR/MR, demande confirmation | Pas de confirmation (avec --yes) |
| `bump` | Affiche changelog, demande confirmation | Erreurs uniquement (avec --yes) |

### Messages toujours affich√©s

M√™me en mode silencieux :
- ‚ùå **Erreurs** : Toujours visibles
- ‚úÖ **Succ√®s finaux** : Message de confirmation

### Combinaisons utiles

```bash
# CI/CD : Tout automatique, silencieux
SILENT_MODE=true gittbd finish --pr --yes

# Debug + Silencieux : Juste les erreurs + logs debug
DEBUG_MODE=true SILENT_MODE=true gittbd validate
```

---

## ü¶ä Support GitLab

`gittbd` fonctionne parfaitement avec GitLab !

### Configuration

```bash
# Installer GitLab CLI
curl -s https://gitlab.com/gitlab-org/cli/-/releases/permalink/latest/downloads/glab_amd64.deb -o glab.deb
sudo dpkg -i glab.deb

# Authentification
glab auth login

# Configurer la plateforme
export GIT_PLATFORM=gitlab
echo 'export GIT_PLATFORM=gitlab' >> ~/.zshrc

# OU dans lib/config.sh
GIT_PLATFORM="gitlab"
```

### Utilisation

```bash
# Les commandes s'adaptent automatiquement
gittbd mr feature/test      # Cr√©e une Merge Request
gittbd validate feature/test  # Valide la MR

# Les messages utilisent "MR" au lieu de "PR"
# üîç Validation de la MR sur branche : feature/test
# ‚úÖ MR trouv√©e
```

### Diff√©rences GitHub vs GitLab

| Aspect | GitHub | GitLab |
|--------|--------|--------|
| CLI | `gh` | `glab` |
| Terminologie | Pull Request (PR) | Merge Request (MR) |
| Commandes | `gittbd pr` | `gittbd mr` |
| **local-squash** | ‚úÖ Fonctionne | ‚úÖ Fonctionne |

**Note** : Le **local-squash** est ind√©pendant de la plateforme (Git local), il fonctionne partout ! üéâ

---

## üéØ Workflow quotidien recommand√©

```bash
# 1. Cr√©er une branche (mode interactif)
gittbd s
# ‚Üí Choisir le type avec fzf
# ‚Üí Entrer le nom

# 2. D√©velopper
git add .
git commit -m "feat: description"

# 3. Publier + cr√©er PR/MR
gittbd f --pr

# 4. Apr√®s review, valider
gittbd v

# 5. Quand pr√™t pour release
git checkout main
gittbd bump minor
```

---

## üìö Documentation avanc√©e

- [VERSIONING.md](docs/VERSIONING.md) - Guide complet du versioning avec tags
- [TUTORIAL.md](docs/TUTORIAL.md) - Tutorial pas-√†-pas d'un projet complet

---

## üõ†Ô∏è Configuration

Fichier : `~/.local/share/gittbd/lib/config.sh`

```bash
# Branche principale
DEFAULT_BASE_BRANCH="main"

# Mode de merge par d√©faut
DEFAULT_MERGE_MODE="local-squash"  # squash | merge | local-squash

# Plateforme
GIT_PLATFORM="github"  # github | gitlab

# √âmojis dans les commits
USE_EMOJI_IN_COMMIT_TITLE=true  # true | false

# Exiger une PR/MR pour finish
REQUIRE_PR_ON_FINISH=true

# Gestion des branches diverg√©es
DEFAULT_DIVERGED_STRATEGY="ask"  # ask | force-push | force-sync
SILENT_DIVERGED_FALLBACK="force-push"
```

---

## üß≠ Syst√®mes support√©s

- ‚úÖ **Linux** (test√© sous Ubuntu / Debian / WSL)
- ‚ö†Ô∏è **macOS** : Non test√©, devrait fonctionner
- ‚ùå **Windows** : Utiliser WSL

---

## üéì Pourquoi Trunk-Based Development ?

Le TBD est un workflow Git qui privil√©gie :

1. ‚úÖ **Une seule branche principale** (`main`)
2. ‚úÖ **Branches courtes dur√©es** (quelques heures/jours max)
3. ‚úÖ **Int√©gration continue** (merge fr√©quent)
4. ‚úÖ **Historique propre** (squash recommand√©)
5. ‚úÖ **Code review obligatoire** (PR/MR)

**Id√©al pour** :
- √âquipes agiles avec sprints courts
- D√©ploiement continu (prod √† chaque merge)
- Petites/moyennes √©quipes (2-10 devs)
- Projets avec releases fr√©quentes

**gittbd** automatise ce workflow et force les bonnes pratiques ! üöÄ

---

## ü§ù Contributions

Pull Requests et suggestions bienvenues !

1. Fork le projet
2. Cr√©er une branche : `gittbd start feature/ma-feature`
3. Commit : `git commit -m "feat: description"`
4. Push : `gittbd publish`
5. Ouvrir une PR : `gittbd pr`

---

## üìÑ Licence

MIT - Voir [LICENSE](LICENSE)

---

## üôè Cr√©dits

Cr√©√© par **nono.pxbsd**

Inspir√© par les pratiques Trunk-Based Development et les workflows modernes de d√©veloppement.